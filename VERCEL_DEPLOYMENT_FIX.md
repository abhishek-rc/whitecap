# Vercel Deployment Fix Guide

## Issue
The Vertex AI Search Next.js application is returning 500 errors on Vercel because Google Cloud credentials are not properly configured in the production environment.

## Root Cause
- Local development works because it uses the service account key file directly
- Vercel production environment doesn't have access to the service account key file
- Environment variables need to be properly configured for Google Cloud authentication

## Solution

### Step 1: Configure Vercel Environment Variables

1. Go to [Vercel Dashboard](https://vercel.com/dashboard)
2. Navigate to your project: `vertex-ai-search-nextjs`
3. Go to **Settings** → **Environment Variables**
4. Add the following environment variables:

#### Required Environment Variables:

```bash
# Google Cloud Configuration
GOOGLE_CLOUD_PROJECT_ID=gwa-vertex
VERTEX_AI_LOCATION=global
VERTEX_AI_CATALOG_ID=default_catalog
VERTEX_AI_BRANCH_ID=0
VERTEX_AI_PLACEMENT_ID=recently_viewed_default

# Google Cloud Service Account Credentials (Base64 encoded)
GOOGLE_APPLICATION_CREDENTIALS=ew0KICAidHlwZSI6ICJzZXJ2aWNlX2FjY291bnQiLA0KICAicHJvamVjdF9pZCI6ICJnd2EtdmVydGV4IiwNCiAgInByaXZhdGVfa2V5X2lkIjogIjk0MDJmYTgzNmIxMjcyMzM4ZTA3NTI0ODQyZGNmZDcxZGQzMTgzZGYiLA0KICAicHJpdmF0ZV9rZXkiOiAiLS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tXG5NSUlFdlFJQkFEQU5CZ2txaGtpRzl3MEJBUUVGQUFTQ0JLY3dnZ1NqQWdFQUFvSUJBUURZa2hHQUxHMTU3QWRHXG54TFBHVDZuWDl1b2hySXluUTdSSzVBV256KzVjVEhQWHZKK3FxK0s1TFY5Nm83SEJvY2Z3Qkk2TmltL2R4cVdYXG5DWjN3UW5QNlUrWmcwTTNlS0FPVC9NN0ZvbGZHMGtZWHYvUUpWK0NTNWZpRlR0NURWbVBvU3NjdVBjbis5YS9XXG5LQVB4UmY1RnFrc0xsMVhYd1VpQ0pwWXhVNXRudGN6VUUweHJUdnRucWVWRWs3Y0NCMlAvQ25RaFVCcTBWcGVMXG5TaDNRcUYzSFZxcDJHclczUHc1VGtXTXp1eTZTUHF3cGhuTWI4TVYyMGkrUlZpdFVQSjU1alVvTURRaDhkM3A0XG5PS3VoSHI4amZHUzhWMThxTnFxN3o0bFZtc2JxRnVhUWFZWUFjc3pidkJTUllrYStLQ0U5emJnRk9UQkRKamhQXG5wQkFKYkRMckFnTUJBQUVDZ2dFQVVxTitJUklTM2l5bDVDZW56N3JUUFBEZmkyVHJzT0doV05oa25oRzJTeXJ6XG5Jelc3R1dXSVdJL0xPS0ZnOFZtWjBPajBPbWRDWTNacTlsUzVteFhJYXBOOE82SkJoQTF4dkJVQ0U2RHNiSllOXG5ILy9qajNNa1l2bDAyTzFzMjNZS0huZjJSQnRZeWp5VzBabW9VM2NaWFJ6cmtPczQydURLbWJzK29XamRTbmQ5XG5TUTYxQ2ZZM3hjbHhWNnNtMjRnS1dKeUJ4aUd2eHZQQVZlQVNta3VDeDhwRzBpZjZRanFCVFFUQmtpWkNkNjhzXG55NEdHWC9WczhlRHk4RlhjZkV5V0E0OUxoMjJPRktiRmkwdUVxcnZlSHRBT1BxTHpjNUNXZkJ2anNFZnZVQXlhXG51TlYxeC81bkVQYitLM0duTkNaRUgrdUoxZjZmL3A1UDZ4bGQydUwrRFFLQmdRRDVWUWFBdXV5QnRkWmpkeEl2XG5ZTWgyS1FlZ0NhNGhVcG5RbjlwamxBdUVoTmxHckJGRUxJdWtjTUt0dWFYZ0RsRHd2OWpQTDhXQk44TmlreWRiXG5udTRFNWxKTVV2eEs4dUIwajdzWHFQUEFZNmpteXFUYXRYRmx6Q1FvM29kYWJiWkQwbjRDTGVmZjdFQzY1YWc5XG40NjNxb0FzdHNyS0hCZ1htYkNmSmFiaGJmUUtCZ1FEZVhNQlFpQ3FRWVM2K0NuT2JlT2N6SjE3Y0VoSEFpakdHXG51UHdUZFVTUE84RFptMUZPd1MzWGhLTXFTcHg0QXVWVDZSVjFtSEYyVW4reldnS1prdDZJZFIySFA2ZVE2dTNsXG5rdnNYNTgzS0ZCYnhTQm1pRWtmYkxTM25wRnpmYm00MlZBdzhjTmc3OUtmdmsyK3Y5OXVSb0RIVUZ0N25UWU11XG53YUpXVmI0RWh3S0JnRG8vQUt2bC93WTJRb1V0OWRPWG1uendETlg0TFBPZjVrcjBiUUpDUFlhUnVtaG1IZ3A5XG5GWW91eFd2c0tMSDA1amUzdWFCOUduaWJYRXVVOE9iWWMrWTFJQml3Y2p2WURWTnRtRmxvb0xqYkQwUUxKd1BvXG55enJxdTYvSWZIcEZrd1M1RWJMVW9veVBGbmdTMm9ES3hZQkFMeHhYMkpqdWNVWnBFY3BkcGpISkFvR0JBS1E1XG5lRWVCNlgyc2FLc3VhT2VBU2JDNytSRXJ2elNtVzZHV2FZV3RiQzhsQUc4MmlMeFRiQm5wK2QrNEx3dHJpQmVLXG40N0J3SUF3MUxkODJNUWxmTVQ4eXo5WWRxeElha0F5bm13Nnl3b2ZtZ25NOHZzRzJJcCs3SkZZYVRBVXdOL0dqXG43VTJPUWdVMTBmbmN0L1lNWm51TkJvQVBUQjBrWUNoZUZoa1JSajl0QW9HQVlpMENkQWJFL2tKOEMytnAyRFJBXG4yZk1kMCs1YTh5NWdqekkzKzEvOVVLVjhrSG5ySkYvOWRNKy8zb0JuYU0wSXF3QlVCdHJacDdxMlRmKzVZaVYxXG52MXpvem9wQ3lrWnplOFhMeG9CQXRWdXk2WGFHUnlSTTlMT2NCSEc4Mk5DWlF2eFZlcW54eER0bk11b09JdWw4XG5scjFZSXlGRWFtdUpZcTNBc3MxRXcwWT1cbi0tLS0tRU5EIFBSSVZBVEUgS0VZLS0tLS1cbiIsDQogICJjbGllbnRfZW1haWwiOiAic2VydmljZS1mb29kcy12ZXJ0ZXgtYWlAZ3dhLXZlcnRleC5pYW0uZ3NlcnZpY2VhY2NvdW50LmNvbSIsDQogICJjbGllbnRfaWQiOiAiMTEyMjQxNTg3ODExMjkwNDc1NDgzIiwNCiAgImF1dGhfdXJpIjogImh0dHBzOi8vYWNjb3VudHMuZ29vZ2xlLmNvbS9vL29hdXRoMi9hdXRoIiwNCiAgInRva2VuX3VyaSI6ICJodHRwczovL29hdXRoMi5nb29nbGVhcGlzLmNvbS90b2tlbiIsDQogICJhdXRoX3Byb3ZpZGVyX3g1MDlfY2VydF91cmwiOiAiaHR0cHM6Ly93d3cuZ29vZ2xlYXBpcy5jb20vb2F1dGgyL3YxL2NlcnRzIiwNCiAgImNsaWVudF94NTA5X2NlcnRfdXJsIjogImh0dHBzOi8vd3d3Lmdvb2dsZWFwaXMuY29tL3JvYm90L3YxL21ldGFkYXRhL3g1MDkvc2VydmljZS1mb29kcy12ZXJ0ZXgtYWklNDBnd2EtdmVydGV4LmlhbS5nc2VydmljZWFjY291bnQuY29tIiwNCiAgInVuaXZlcnNlX2RvbWFpbiI6ICJnb29nbGVhcGlzLmNvbSINCn0NCg==
```

### Step 2: Redeploy Application

After adding the environment variables:

1. Go to **Deployments** tab in your Vercel dashboard
2. Click **Redeploy** on the latest deployment
3. Or push a small change to your repository to trigger a new deployment

### Step 3: Verify the Fix

1. Visit your deployed application: https://vertex-ai-search-nextjs.vercel.app/
2. Check the debug endpoint: https://vertex-ai-search-nextjs.vercel.app/api/debug
3. Test the search functionality
4. Verify that products and recommendations are loading

### Step 4: Monitor for Issues

If you still experience issues:

1. Check Vercel function logs in the dashboard
2. Visit the debug endpoint to see authentication status
3. Ensure all environment variables are properly set

## Environment Variable Types

The authentication system supports three types of credential configuration:

1. **File path** (local development): `GOOGLE_APPLICATION_CREDENTIALS=vertex-ai-key.json`
2. **Base64 encoded** (recommended for Vercel): Uses the long base64 string above
3. **Direct JSON** (alternative): Paste the JSON object directly

## Security Notes

- The credentials are properly scoped to only the necessary Google Cloud services
- Environment variables are encrypted at rest in Vercel
- Never commit credential files to version control
- Consider rotating service account keys periodically

## Testing Commands

You can test the deployment locally with the base64 credentials:

```bash
# Set the base64 credential in your local environment
export GOOGLE_APPLICATION_CREDENTIALS="ew0KICAidHlwZSI6ICJzZXJ2aWNlX2FjY291bnQiLA0KICAicHJvamVjdF9pZCI6ICJnd2EtdmVydGV4IiwNCiAgInByaXZhdGVfa2V5X2lkIjogIjk0MDJmYTgzNmIxMjcyMzM4ZTA3NTI0ODQyZGNmZDcxZGQzMTgzZGYiLA0KICAicHJpdmF0ZV9rZXkiOiAiLS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tXG5NSUlFdlFJQkFEQU5CZ2txaGtpRzl3MEJBUUVGQUFTQ0JLY3dnZ1NqQWdFQUFvSUJBUURZa2hHQUxHMTU3QWRHXG54TFBHVDZuWDl1b2hySXluUTdSSzVBV256KzVjVEhQWHZKK3FxK0s1TFY5Nm83SEJvY2Z3Qkk2TmltL2R4cVdYXG5DWjN3UW5QNlUrWmcwTTNlS0FPVC9NN0ZvbGZHMGtZWHYvUUpWK0NTNWZpRlR0NURWbVBvU3NjdVBjbis5YS9XXG5LQVB4UmY1RnFrc0xsMVhYd1VpQ0pwWXhVNXRudGN6VUUweHJUdnRucWVWRWs3Y0NCMlAvQ25RaFVCcTBWcGVMXG5TaDNRcUYzSFZxcDJHclczUHc1VGtXTXp1eTZTUHF3cGhuTWI4TVYyMGkrUlZpdFVQSjU1alVvTURRaDhkM3A0XG5PS3VoSHI4amZHUzhWMThxTnFxN3o0bFZtc2JxRnVhUWFZWUFjc3pidkJTUllrYStLQ0U5emJnRk9UQkRKamhQXG5wQkFKYkRMckFnTUJBQUVDZ2dFQVVxTitJUklTM2l5bDVDZW56N3JUUFBEZmkyVHJzT0doV05oa25oRzJTeXJ6XG5Jelc3R1dXSVdJL0xPS0ZnOFZtWjBPajBPbWRDWTNacTlsUzVteFhJYXBOOE82SkJoQTF4dkJVQ0U2RHNiSllOXG5ILy9qajNNa1l2bDAyTzFzMjNZS0huZjJSQnRZeWp5VzBabW9VM2NaWFJ6cmtPczQydURLbWJzK29XamRTbmQ5XG5TUTYxQ2ZZM3hjbHhWNnNtMjRnS1dKeUJ4aUd2eHZQQVZlQVNta3VDeDhwRzBpZjZRanFCVFFUQmtpWkNkNjhzXG55NEdHWC9WczhlRHk4RlhjZkV5V0E0OUxoMjJPRktiRmkwdUVxcnZlSHRBT1BxTHpjNUNXZkJ2anNFZnZVQXlhXG51TlYxeC81bkVQYitLM0duTkNaRUgrdUoxZjZmL3A1UDZ4bGQydUwrRFFLQmdRRDVWUWFBdXV5QnRkWmpkeEl2XG5ZTWgyS1FlZ0NhNGhVcG5RbjlwamxBdUVoTmxHckJGRUxJdWtjTUt0dWFYZ0RsRHd2OWpQTDhXQk44TmlreWRiXG5udTRFNWxKTVV2eEs4dUIwajdzWHFQUEFZNmpteXFUYXRYRmx6Q1FvM29kYWJiWkQwbjRDTGVmZjdFQzY1YWc5XG40NjNxb0FzdHNyS0hCZ1htYkNmSmFiaGJmUUtCZ1FEZVhNQlFpQ3FRWVM2K0NuT2JlT2N6SjE3Y0VoSEFpakdHXG51UHdUZFVTUE84RFptMUZPd1MzWGhLTXFTcHg0QXVWVDZSVjFtSEYyVW4reldnS1prdDZJZFIySFA2ZVE2dTNsXG5rdnNYNTgzS0ZCYnhTQm1pRWtmYkxTM25wRnpmYm00MlZBdzhjTmc3OUtmdmsyK3Y5OXVSb0RIVUZ0N25UWU11XG53YUpXVmI0RWh3S0JnRG8vQUt2bC93WTJRb1V0OWRPWG1uendETlg0TFBPZjVrcjBiUUpDUFlhUnVtaG1IZ3A5XG5GWW91eFd2c0tMSDA1amUzdWFCOUduaWJYRXVVOE9iWWMrWTFJQml3Y2p2WURWTnRtRmxvb0xqYkQwUUxKd1BvXG55enJxdTYvSWZIcEZrd1M1RWJMVW9veVBGbmdTMm9ES3hZQkFMeHhYMkpqdWNVWnBFY3BkcGpISkFvR0JBS1E1XG5lRWVCNlgyc2FLc3VhT2VBU2JDNytSRXJ2elNtVzZHV2FZV3RiQzhsQUc4MmlMeFRiQm5wK2QrNEx3dHJpQmVLXG40N0J3SUF3MUxkODJNUWxmTVQ4eXo5WWRxeElha0F5bm13Nnl3b2ZtZ25NOHZzRzJJcCs3SkZZYVRBVXdOL0dqXG43VTJPUWdVMTBmbmN0L1lNWm51TkJvQVBUQjBrWUNoZUZoa1JSajl0QW9HQVlpMENkQWJFL2tKOEMytnAyRFJBXG4yZk1kMCs1YTh5NWdqekkzKzEvOVVLVjhrSG5ySkYvOWRNKy8zb0JuYU0wSXF3QlVCdHJacDdxMlRmKzVZaVYxXG52MXpvem9wQ3lrWnplOFhMeG9CQXRWdXk2WGFHUnlSTTlMT2NCSEc4Mk5DWlF2eFZlcW54eER0bk11b09JdWw4XG5scjFZSXlGRWFtdUpZcTNBc3MxRXcwWT1cbi0tLS0tRU5EIFBSSVZBVEUgS0VZLS0tLS1cbiIsDQogICJjbGllbnRfZW1haWwiOiAic2VydmljZS1mb29kcy12ZXJ0ZXgtYWlAZ3dhLXZlcnRleC5pYW0uZ3NlcnZpY2VhY2NvdW50LmNvbSIsDQogICJjbGllbnRfaWQiOiAiMTEyMjQxNTg3ODExMjkwNDc1NDgzIiwNCiAgImF1dGhfdXJpIjogImh0dHBzOi8vYWNjb3VudHMuZ29vZ2xlLmNvbS9vL29hdXRoMi9hdXRoIiwNCiAgInRva2VuX3VyaSI6ICJodHRwczovL29hdXRoMi5nb29nbGVhcGlzLmNvbS90b2tlbiIsDQogICJhdXRoX3Byb3ZpZGVyX3g1MDlfY2VydF91cmwiOiAiaHR0cHM6Ly93d3cuZ29vZ2xlYXBpcy5jb20vb2F1dGgyL3YxL2NlcnRzIiwNCiAgImNsaWVudF94NTA5X2NlcnRfdXJsIjogImh0dHBzOi8vd3d3Lmdvb2dsZWFwaXMuY29tL3JvYm90L3YxL21ldGFkYXRhL3g1MDkvc2VydmljZS1mb29kcy12ZXJ0ZXgtYWklNDBnd2EtdmVydGV4LmlhbS5nc2VydmljZWFjY291bnQuY29tIiwNCiAgInVuaXZlcnNlX2RvbWFpbiI6ICJnb29nbGVhcGlzLmNvbSINCn0NCg=="

# Test the build
npm run build

# Test the dev server
npm run dev
```

## Expected Results

After applying this fix:

1. ✅ Search functionality works on production
2. ✅ Product recommendations display correctly
3. ✅ All API endpoints return proper responses
4. ✅ Debug endpoint shows successful authentication
5. ✅ No more 500 errors in production

## Next Steps

1. Monitor application performance in production
2. Set up logging and monitoring for production issues
3. Consider implementing health checks for the Google Cloud services
4. Set up alerts for authentication failures
